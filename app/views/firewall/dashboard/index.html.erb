<div id="main" class="row">
  <div class="col-lg-10 col-lg-offset-1">

    <% if !@message.nil? %>
    <div class="alert fade in">
      <button type="button" class="close" data-dismiss="alert">Ã—</button>
      <strong>Message: </strong><%= @message.html_safe %>
    </div>
    <% end %>

    <legend>All Rules <span class="toggle-button" data-toggle="collapse" data-target="#rules"></span></legend>
    <div id="rules" class="collapse in">
      <pre><%= Firewall::IptablesHelper.show_rules() %></pre>      
      
      <form action="<%= url_for :controller => 'dashboard', :action => 'activate_blacklisting' %>" method="get">
        <fieldset>
          <button type="submit" class="btn btn-default" <%= Firewall::DashboardHelper.blacklisting_active? ? "disabled=\"disabled\"" : "" %>>Activate blacklisting</button>
          <p class="help-block">Blacklisting is currently <%= Firewall::DashboardHelper.blacklisting_active? ? "active" : "NOT active" %></p>
        </fieldset>
      </form>
    </div>

    <br>

    <%= render "firewall/partials/protected_urls" %>

    <br>

    <legend>Blacklisted IPs</legend>
    <pre><%= Firewall::IptablesHelper.blacklisted_ips() %></pre>      
    
    <br>

    <legend>Danger Area</legend>
    <div class="well">
      <form action="<%= url_for :controller => 'rules', :action => 'reset' %>">
          <fieldset>
            <a href="<%= url_for :controller => 'dashboard', :action => 'dump_rules' %>" class="btn btn-success">Download firewall rules</a>
            <button type="button" id="restoreButton" class="btn btn-warning">Restore firewall rules</button>
            <button type="button" id="resetButton" class="btn btn-danger">Reset firewall rules</button>
          </fieldset>
      </form>
    </div>

  </div>
</div>

<script type="text/javascript">
  $(function() {
    $('#resetButton').click(function() {

      if(confirm("Are you sure to reset all config?")){
        $.ajax({
          url: $(this).closest('form').attr('action'),
          method: 'delete',
          complete: function() {
            window.location.href = "<%= url_for :controller => 'dashboard', :action => 'index' %>"
          }
        });

      }

    });
  });

</script>
